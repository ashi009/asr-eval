# ASR Evaluation Tool - Agent Context

This document provides context for AI agents working on this codebase.

## Architecture

The project consists of a Go backend and a React (Vite) frontend.

-   **Backend**: specific HTTP handlers in `cmd/server/main.go` serve the API and static files.
    -   `/api/cases`: Lists available cases (audio/transcript pairs).
    -   `/api/case`: Retrieves details for a specific case.
    -   `/api/save-gt`: Updates the Ground Truth for a specific case.
    -   `/api/evaluate-llm`: Triggers LLM-based evaluation for selected ASR providers.
    -   `/api/config`: Exposes server configuration (e.g., current LLM model).
    -   `/api/reset-eval`: Deletes evaluation reports for the current model.
-   **Frontend**: A Single Page Application (SPA) in `ui/`.
    -   `App.tsx`: Main logic.
    -   `config.ts`: ASR Provider configuration (names, colors).

## Key Workflows

1.  **Listing Cases**: Scans the dataset directory for `.flac` files and corresponding reports.
    -   **Filtering**: The server STRICTLY filters reports to only show those matching the active LLM model.
2.  **Evaluation**:
    -   **LLM**: User triggers LLM eval. Saved to `[ID].[MODEL].report.json` (e.g., `id.gemini-2.5-flash.report.json`).
3.  **Reset**:
    -   Users can reset (delete) reports for the *current* model via the UI.

## Configuration

-   The dataset directory is configurable via the `--dataset-dir` flag in the server.
-   **LLM Model**: Must be specified via `--llm-model` (e.g., `./server -llm-model gemini-2.5-flash`).
-   Secrets are loaded from `.env` using `godotenv`.

## Domain Vocabulary

| Term | Definition |
| :--- | :--- |
| **Case** | The core unit of analysis, representing a single audio segment. Includes metadata (`id`), candidate transcripts from various providers, Ground Truth (`.gt.json`), and the Eval Report (`.report.json`). |
| **ASR Provider** | A service that generates a candidate transcript (e.g., "Volc", "Tencent", "Azure"). Previously referred to as "Service" or "Provider". |
| **Transcript** | The candidate text generated by an ASR Provider for a given audio case. |
| **Ground Truth (GT)** | The verified, correct transcript text, stored in `.gt.json`. Used as the reference for evaluation. |
| **EvalResult** | The evaluation outcome for a *single* ASR Provider's transcript, containing a score, revised version, and summary. |
| **EvalReport** | The collection of all `EvalResult`s for a Case, plus the snapshot of the Ground Truth used effectively during that evaluation run. Stored in `.report.json`. |
| **EvalContext** | The generated context used to evaluate a case. Contains metadata (`ContextMeta`) and a set of `Checkpoint`s derived from Ground Truth. Stored in `.gt.v2.json`. |
| **Checkpoint** | A specific, verifiable criterion derived from the Ground Truth (e.g., "Must mention 'refund'"). Used to score transcripts. |

## Coding Standards

### Type Consistency

-   **Frontend vs Backend**: Frontend TypeScript interfaces in `ui/src/types.ts` MUST strictly match the corresponding Go structs in `pkg/evalv2/types.go` in both name and structure.
    -   Example: Go `EvalContext` -> TS `EvalContext` (NOT `ContextResponse`)
    -   Example: Go `EvalReport` -> TS `EvalReport` (NOT `EvaluationResponse`)
    -   This rule ensures that the frontend and backend speak the same language and reduces serialization/deserialization confusion.
